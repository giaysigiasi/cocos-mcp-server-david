"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.PrefabToolsTest = void 0;
const prefab_tools_1 = require("../tools/prefab-tools");
// Prefab tools test
class PrefabToolsTest {
    constructor() {
        this.prefabTools = new prefab_tools_1.PrefabTools();
    }
    async runAllTests() {
        console.log('Starting prefab tools test...');
        try {
            // Test 1: Get tool list
            await this.testGetTools();
            // Test 2: Get prefab list
            await this.testGetPrefabList();
            // Test 3: Test prefab creation (simulated)
            await this.testCreatePrefab();
            // Test 3.5: Test prefab instantiation (simulated)
            await this.testInstantiatePrefab();
            // Test 4: Test prefab validation
            await this.testValidatePrefab();
            console.log('All tests completed!');
        }
        catch (error) {
            console.error('Error occurred during testing:', error);
        }
    }
    async testGetTools() {
        console.log('Test 1: Get tool list');
        const tools = this.prefabTools.getTools();
        console.log(`Found ${tools.length} tools:`);
        tools.forEach(tool => {
            console.log(`  - ${tool.name}: ${tool.description}`);
        });
        console.log('Test 1 completed\n');
    }
    async testGetPrefabList() {
        var _a;
        console.log('Test 2: Get prefab list');
        try {
            const result = await this.prefabTools.execute('get_prefab_list', { folder: 'db://assets' });
            if (result.success) {
                console.log(`Found ${((_a = result.data) === null || _a === void 0 ? void 0 : _a.length) || 0} prefabs`);
                if (result.data && result.data.length > 0) {
                    result.data.slice(0, 3).forEach((prefab) => {
                        console.log(`  - ${prefab.name}: ${prefab.path}`);
                    });
                }
            }
            else {
                console.log('Failed to get prefab list:', result.error);
            }
        }
        catch (error) {
            console.log('Error occurred while getting prefab list:', error);
        }
        console.log('Test 2 completed\n');
    }
    async testCreatePrefab() {
        console.log('Test 3: Test prefab creation (simulated)');
        try {
            // Simulate creating prefab
            const mockArgs = {
                nodeUuid: 'mock-node-uuid',
                savePath: 'db://assets/test',
                prefabName: 'TestPrefab'
            };
            const result = await this.prefabTools.execute('create_prefab', mockArgs);
            console.log('Create prefab result:', result);
        }
        catch (error) {
            console.log('Error occurred while creating prefab:', error);
        }
        console.log('Test 3 completed\n');
    }
    async testInstantiatePrefab() {
        console.log('Test 3.5: Test prefab instantiation (simulated)');
        try {
            // Simulate instantiating prefab
            const mockArgs = {
                prefabPath: 'db://assets/prefabs/TestPrefab.prefab',
                parentUuid: 'canvas-uuid',
                position: { x: 100, y: 200, z: 0 }
            };
            const result = await this.prefabTools.execute('instantiate_prefab', mockArgs);
            console.log('Instantiate prefab result:', result);
            // Test API parameter construction
            this.testCreateNodeAPIParams();
        }
        catch (error) {
            console.log('Error occurred while instantiating prefab:', error);
        }
        console.log('Test 3.5 completed\n');
    }
    testCreateNodeAPIParams() {
        console.log('Testing create-node API parameter construction...');
        // Simulate assetUuid
        const assetUuid = 'mock-prefab-uuid';
        // Test basic parameters
        const basicOptions = {
            assetUuid: assetUuid,
            name: 'TestPrefabInstance'
        };
        console.log('Basic parameters:', basicOptions);
        // Test parameters with parent node
        const withParentOptions = Object.assign(Object.assign({}, basicOptions), { parent: 'parent-node-uuid' });
        console.log('Parameters with parent node:', withParentOptions);
        // Test parameters with position
        const withPositionOptions = Object.assign(Object.assign({}, basicOptions), { dump: {
                position: { x: 100, y: 200, z: 0 }
            } });
        console.log('Parameters with position:', withPositionOptions);
        // Test complete parameters
        const fullOptions = {
            assetUuid: assetUuid,
            name: 'TestPrefabInstance',
            parent: 'parent-node-uuid',
            dump: {
                position: { x: 100, y: 200, z: 0 }
            },
            keepWorldTransform: false,
            unlinkPrefab: false
        };
        console.log('Complete parameters:', fullOptions);
    }
    async testValidatePrefab() {
        console.log('Test 4: Test prefab validation');
        try {
            // Test validating a non-existent prefab
            const result = await this.prefabTools.execute('validate_prefab', {
                prefabPath: 'db://assets/nonexistent.prefab'
            });
            console.log('Validate prefab result:', result);
        }
        catch (error) {
            console.log('Error occurred while validating prefab:', error);
        }
        console.log('Test 4 completed\n');
    }
    // Test prefab data structure generation
    testPrefabDataGeneration() {
        console.log('Testing prefab data structure generation...');
        const mockNodeData = {
            name: 'TestNode',
            position: { x: 0, y: 0, z: 0 },
            scale: { x: 1, y: 1, z: 1 },
            active: true,
            children: [],
            components: [
                {
                    type: 'cc.UITransform',
                    enabled: true,
                    properties: {
                        _contentSize: { width: 100, height: 100 },
                        _anchorPoint: { x: 0.5, y: 0.5 }
                    }
                }
            ]
        };
        const prefabUuid = this.prefabTools['generateUUID']();
        const prefabData = this.prefabTools['createPrefabData'](mockNodeData, 'TestPrefab', prefabUuid);
        console.log('Generated prefab data structure:');
        console.log(JSON.stringify(prefabData, null, 2));
        // Validate data structure
        const validationResult = this.prefabTools['validatePrefabFormat'](prefabData);
        console.log('Validation result:', validationResult);
        console.log('Prefab data structure generation test completed\n');
    }
    // Test UUID generation
    testUUIDGeneration() {
        console.log('Testing UUID generation...');
        const uuids = [];
        for (let i = 0; i < 5; i++) {
            const uuid = this.prefabTools['generateUUID']();
            uuids.push(uuid);
            console.log(`UUID ${i + 1}: ${uuid}`);
        }
        // Check UUID format
        const uuidPattern = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
        const validUuids = uuids.filter(uuid => uuidPattern.test(uuid));
        console.log(`UUID format validation: ${validUuids.length}/${uuids.length} valid`);
        console.log('UUID generation test completed\n');
    }
}
exports.PrefabToolsTest = PrefabToolsTest;
// If running this file directly
if (typeof module !== 'undefined' && module.exports) {
    const test = new PrefabToolsTest();
    test.runAllTests();
    test.testPrefabDataGeneration();
    test.testUUIDGeneration();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlZmFiLXRvb2xzLXRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvdGVzdC9wcmVmYWItdG9vbHMtdGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSx3REFBb0Q7QUFFcEQsb0JBQW9CO0FBQ3BCLE1BQWEsZUFBZTtJQUd4QjtRQUNJLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSwwQkFBVyxFQUFFLENBQUM7SUFDekMsQ0FBQztJQUVELEtBQUssQ0FBQyxXQUFXO1FBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1FBRTdDLElBQUksQ0FBQztZQUNELHdCQUF3QjtZQUN4QixNQUFNLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUUxQiwwQkFBMEI7WUFDMUIsTUFBTSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUUvQiwyQ0FBMkM7WUFDM0MsTUFBTSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUU5QixrREFBa0Q7WUFDbEQsTUFBTSxJQUFJLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUVuQyxpQ0FBaUM7WUFDakMsTUFBTSxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztZQUVoQyxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDeEMsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDYixPQUFPLENBQUMsS0FBSyxDQUFDLGdDQUFnQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzNELENBQUM7SUFDTCxDQUFDO0lBRU8sS0FBSyxDQUFDLFlBQVk7UUFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEtBQUssQ0FBQyxNQUFNLFNBQVMsQ0FBQyxD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LENBQUM7UUFFMUMsTUFBTSxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN6QixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7WUFDaEQsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNqQixPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFFRCxvQkFBb0I7UUFDcEIsTUFBTSxXQUFXLEdBQUcsaUVBQWlFLENBQUM7UUFDdEYsTUFBTSxVQUFVLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUVoRSxPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixVQUFVLENBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLFFBQVEsQ0FBQyxDQUFDO1FBQ2xGLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0NBQWtDLENBQUMsQ0FBQztJQUNwRCxDQUFDO0NBQ0o7QUFuTkQsMENBbU5DO0FBRUQsZ0NBQWdDO0FBQ2hDLElBQUksT0FBTyxNQUFNLEtBQUssV0FBVyxJQUFJLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNsRCxNQUFNLElBQUksR0FBRyxJQUFJLGVBQWUsRUFBRSxDQUFDO0lBQ25DLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNuQixJQUFJLENBQUMsd0JBQXdCLEVBQUUsQ0FBQztJQUNoQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsQ0FBQztBQUM5QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUHJlZmFiVG9vbHMgfSBmcm9tICcuLi90b29scy9wcmVmYWItdG9vbHMnO1xyXG5cclxuLy8gUHJlZmFiIHRvb2xzIHRlc3RcclxuZXhwb3J0IGNsYXNzIFByZWZhYlRvb2xzVGVzdCB7XHJcbiAgICBwcml2YXRlIHByZWZhYlRvb2xzOiBQcmVmYWJUb29scztcclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnByZWZhYlRvb2xzID0gbmV3IFByZWZhYlRvb2xzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXN5bmMgcnVuQWxsVGVzdHMoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIHByZWZhYiB0b29scyB0ZXN0Li4uJyk7XHJcblxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFRlc3QgMTogR2V0IHRvb2wgbGlzdFxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRlc3RHZXRUb29scygpO1xyXG5cclxuICAgICAgICAgICAgLy8gVGVzdCAyOiBHZXQgcHJlZmFiIGxpc3RcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy50ZXN0R2V0UHJlZmFiTGlzdCgpO1xyXG5cclxuICAgICAgICAgICAgLy8gVGVzdCAzOiBUZXN0IHByZWZhYiBjcmVhdGlvbiAoc2ltdWxhdGVkKVxyXG4gICAgICAgICAgICBhd2FpdCB0aGlzLnRlc3RDcmVhdGVQcmVmYWIoKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFRlc3QgMy41OiBUZXN0IHByZWZhYiBpbnN0YW50aWF0aW9uIChzaW11bGF0ZWQpXHJcbiAgICAgICAgICAgIGF3YWl0IHRoaXMudGVzdEluc3RhbnRpYXRlUHJlZmFiKCk7XHJcblxyXG4gICAgICAgICAgICAvLyBUZXN0IDQ6IFRlc3QgcHJlZmFiIHZhbGlkYXRpb25cclxuICAgICAgICAgICAgYXdhaXQgdGhpcy50ZXN0VmFsaWRhdGVQcmVmYWIoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBbGwgdGVzdHMgY29tcGxldGVkIScpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIG9jY3VycmVkIGR1cmluZyB0ZXN0aW5nOicsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyB0ZXN0R2V0VG9vbHMoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Rlc3QgMTogR2V0IHRvb2wgbGlzdCcpO1xyXG4gICAgICAgIGNvbnN0IHRvb2xzID0gdGhpcy5wcmVmYWJUb29scy5nZXRUb29scygpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBGb3VuZCAke3Rvb2xzLmxlbmd0aH0gdG9vbHM6YCk7XHJcbiAgICAgICAgdG9vbHMuZm9yRWFjaCh0b29sID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYCAgLSAke3Rvb2wubmFtZX06ICR7dG9vbC5kZXNjcmlwdGlvbn1gKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBjb25zb2xlLmxvZygnVGVzdCAxIGNvbXBsZXRlZFxcbicpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgdGVzdEdldFByZWZhYkxpc3QoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Rlc3QgMjogR2V0IHByZWZhYiBsaXN0Jyk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcmVmYWJUb29scy5leGVjdXRlKCdnZXRfcHJlZmFiX2xpc3QnLCB7IGZvbGRlcjogJ2RiOi8vYXNzZXRzJyB9KTtcclxuICAgICAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRm91bmQgJHtyZXN1bHQuZGF0YT8ubGVuZ3RoIHx8IDB9IHByZWZhYnNgKTtcclxuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZGF0YSAmJiByZXN1bHQuZGF0YS5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmRhdGEuc2xpY2UoMCwgMykuZm9yRWFjaCgocHJlZmFiOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCAgLSAke3ByZWZhYi5uYW1lfTogJHtwcmVmYWIucGF0aH1gKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGYWlsZWQgdG8gZ2V0IHByZWZhYiBsaXN0OicsIHJlc3VsdC5lcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnRXJyb3Igb2NjdXJyZWQgd2hpbGUgZ2V0dGluZyBwcmVmYWIgbGlzdDonLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXN0IDIgY29tcGxldGVkXFxuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBhc3luYyB0ZXN0Q3JlYXRlUHJlZmFiKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXN0IDM6IFRlc3QgcHJlZmFiIGNyZWF0aW9uIChzaW11bGF0ZWQpJyk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gU2ltdWxhdGUgY3JlYXRpbmcgcHJlZmFiXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tBcmdzID0ge1xyXG4gICAgICAgICAgICAgICAgbm9kZVV1aWQ6ICdtb2NrLW5vZGUtdXVpZCcsXHJcbiAgICAgICAgICAgICAgICBzYXZlUGF0aDogJ2RiOi8vYXNzZXRzL3Rlc3QnLFxyXG4gICAgICAgICAgICAgICAgcHJlZmFiTmFtZTogJ1Rlc3RQcmVmYWInXHJcbiAgICAgICAgICAgIH07XHJcblxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnByZWZhYlRvb2xzLmV4ZWN1dGUoJ2NyZWF0ZV9wcmVmYWInLCBtb2NrQXJncyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDcmVhdGUgcHJlZmFiIHJlc3VsdDonLCByZXN1bHQpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyBwcmVmYWI6JywgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zb2xlLmxvZygnVGVzdCAzIGNvbXBsZXRlZFxcbicpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgYXN5bmMgdGVzdEluc3RhbnRpYXRlUHJlZmFiKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXN0IDMuNTogVGVzdCBwcmVmYWIgaW5zdGFudGlhdGlvbiAoc2ltdWxhdGVkKScpO1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIC8vIFNpbXVsYXRlIGluc3RhbnRpYXRpbmcgcHJlZmFiXHJcbiAgICAgICAgICAgIGNvbnN0IG1vY2tBcmdzID0ge1xyXG4gICAgICAgICAgICAgICAgcHJlZmFiUGF0aDogJ2RiOi8vYXNzZXRzL3ByZWZhYnMvVGVzdFByZWZhYi5wcmVmYWInLFxyXG4gICAgICAgICAgICAgICAgcGFyZW50VXVpZDogJ2NhbnZhcy11dWlkJyxcclxuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiB7IHg6IDEwMCwgeTogMjAwLCB6OiAwIH1cclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucHJlZmFiVG9vbHMuZXhlY3V0ZSgnaW5zdGFudGlhdGVfcHJlZmFiJywgbW9ja0FyZ3MpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSW5zdGFudGlhdGUgcHJlZmFiIHJlc3VsdDonLCByZXN1bHQpO1xyXG5cclxuICAgICAgICAgICAgLy8gVGVzdCBBUEkgcGFyYW1ldGVyIGNvbnN0cnVjdGlvblxyXG4gICAgICAgICAgICB0aGlzLnRlc3RDcmVhdGVOb2RlQVBJUGFyYW1zKCk7XHJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIG9jY3VycmVkIHdoaWxlIGluc3RhbnRpYXRpbmcgcHJlZmFiOicsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Rlc3QgMy41IGNvbXBsZXRlZFxcbicpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdGVzdENyZWF0ZU5vZGVBUElQYXJhbXMoKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Rlc3RpbmcgY3JlYXRlLW5vZGUgQVBJIHBhcmFtZXRlciBjb25zdHJ1Y3Rpb24uLi4nKTtcclxuXHJcbiAgICAgICAgLy8gU2ltdWxhdGUgYXNzZXRVdWlkXHJcbiAgICAgICAgY29uc3QgYXNzZXRVdWlkID0gJ21vY2stcHJlZmFiLXV1aWQnO1xyXG5cclxuICAgICAgICAvLyBUZXN0IGJhc2ljIHBhcmFtZXRlcnNcclxuICAgICAgICBjb25zdCBiYXNpY09wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIGFzc2V0VXVpZDogYXNzZXRVdWlkLFxyXG4gICAgICAgICAgICBuYW1lOiAnVGVzdFByZWZhYkluc3RhbmNlJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Jhc2ljIHBhcmFtZXRlcnM6JywgYmFzaWNPcHRpb25zKTtcclxuXHJcbiAgICAgICAgLy8gVGVzdCBwYXJhbWV0ZXJzIHdpdGggcGFyZW50IG5vZGVcclxuICAgICAgICBjb25zdCB3aXRoUGFyZW50T3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgLi4uYmFzaWNPcHRpb25zLFxyXG4gICAgICAgICAgICBwYXJlbnQ6ICdwYXJlbnQtbm9kZS11dWlkJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1BhcmFtZXRlcnMgd2l0aCBwYXJlbnQgbm9kZTonLCB3aXRoUGFyZW50T3B0aW9ucyk7XHJcblxyXG4gICAgICAgIC8vIFRlc3QgcGFyYW1ldGVycyB3aXRoIHBvc2l0aW9uXHJcbiAgICAgICAgY29uc3Qgd2l0aFBvc2l0aW9uT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgLi4uYmFzaWNPcHRpb25zLFxyXG4gICAgICAgICAgICBkdW1wOiB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogeyB4OiAxMDAsIHk6IDIwMCwgejogMCB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdQYXJhbWV0ZXJzIHdpdGggcG9zaXRpb246Jywgd2l0aFBvc2l0aW9uT3B0aW9ucyk7XHJcblxyXG4gICAgICAgIC8vIFRlc3QgY29tcGxldGUgcGFyYW1ldGVyc1xyXG4gICAgICAgIGNvbnN0IGZ1bGxPcHRpb25zID0ge1xyXG4gICAgICAgICAgICBhc3NldFV1aWQ6IGFzc2V0VXVpZCxcclxuICAgICAgICAgICAgbmFtZTogJ1Rlc3RQcmVmYWJJbnN0YW5jZScsXHJcbiAgICAgICAgICAgIHBhcmVudDogJ3BhcmVudC1ub2RlLXV1aWQnLFxyXG4gICAgICAgICAgICBkdW1wOiB7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogeyB4OiAxMDAsIHk6IDIwMCwgejogMCB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGtlZXBXb3JsZFRyYW5zZm9ybTogZmFsc2UsXHJcbiAgICAgICAgICAgIHVubGlua1ByZWZhYjogZmFsc2VcclxuICAgICAgICB9O1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdDb21wbGV0ZSBwYXJhbWV0ZXJzOicsIGZ1bGxPcHRpb25zKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIGFzeW5jIHRlc3RWYWxpZGF0ZVByZWZhYigpIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnVGVzdCA0OiBUZXN0IHByZWZhYiB2YWxpZGF0aW9uJyk7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgLy8gVGVzdCB2YWxpZGF0aW5nIGEgbm9uLWV4aXN0ZW50IHByZWZhYlxyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnByZWZhYlRvb2xzLmV4ZWN1dGUoJ3ZhbGlkYXRlX3ByZWZhYicsIHtcclxuICAgICAgICAgICAgICAgIHByZWZhYlBhdGg6ICdkYjovL2Fzc2V0cy9ub25leGlzdGVudC5wcmVmYWInXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnVmFsaWRhdGUgcHJlZmFiIHJlc3VsdDonLCByZXN1bHQpO1xyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvciBvY2N1cnJlZCB3aGlsZSB2YWxpZGF0aW5nIHByZWZhYjonLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXN0IDQgY29tcGxldGVkXFxuJyk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gVGVzdCBwcmVmYWIgZGF0YSBzdHJ1Y3R1cmUgZ2VuZXJhdGlvblxyXG4gICAgdGVzdFByZWZhYkRhdGFHZW5lcmF0aW9uKCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdUZXN0aW5nIHByZWZhYiBkYXRhIHN0cnVjdHVyZSBnZW5lcmF0aW9uLi4uJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1vY2tOb2RlRGF0YSA9IHtcclxuICAgICAgICAgICAgbmFtZTogJ1Rlc3ROb2RlJyxcclxuICAgICAgICAgICAgcG9zaXRpb246IHsgeDogMCwgeTogMCwgejogMCB9LFxyXG4gICAgICAgICAgICBzY2FsZTogeyB4OiAxLCB5OiAxLCB6OiAxIH0sXHJcbiAgICAgICAgICAgIGFjdGl2ZTogdHJ1ZSxcclxuICAgICAgICAgICAgY2hpbGRyZW46IFtdLFxyXG4gICAgICAgICAgICBjb21wb25lbnRzOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2NjLlVJVHJhbnNmb3JtJyxcclxuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX2NvbnRlbnRTaXplOiB7IHdpZHRoOiAxMDAsIGhlaWdodDogMTAwIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hbmNob3JQb2ludDogeyB4OiAwLjUsIHk6IDAuNSB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBdXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgY29uc3QgcHJlZmFiVXVpZCA9IHRoaXMucHJlZmFiVG9vbHNbJ2dlbmVyYXRlVVVJRCddKCk7XHJcbiAgICAgICAgY29uc3QgcHJlZmFiRGF0YSA9IHRoaXMucHJlZmFiVG9vbHNbJ2NyZWF0ZVByZWZhYkRhdGEnXShtb2NrTm9kZURhdGEsICdUZXN0UHJlZmFiJywgcHJlZmFiVXVpZCk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdHZW5lcmF0ZWQgcHJlZmFiIGRhdGEgc3RydWN0dXJlOicpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KHByZWZhYkRhdGEsIG51bGwsIDIpKTtcclxuXHJcbiAgICAgICAgLy8gVmFsaWRhdGUgZGF0YSBzdHJ1Y3R1cmVcclxuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdGhpcy5wcmVmYWJUb29sc1sndmFsaWRhdGVQcmVmYWJGb3JtYXQnXShwcmVmYWJEYXRhKTtcclxuICAgICAgICBjb25zb2xlLmxvZygnVmFsaWRhdGlvbiByZXN1bHQ6JywgdmFsaWRhdGlvblJlc3VsdCk7XHJcblxyXG4gICAgICAgIGNvbnNvbGUubG9nKCdQcmVmYWIgZGF0YSBzdHJ1Y3R1cmUgZ2VuZXJhdGlvbiB0ZXN0IGNvbXBsZXRlZFxcbicpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFRlc3QgVVVJRCBnZW5lcmF0aW9uXHJcbiAgICB0ZXN0VVVJREdlbmVyYXRpb24oKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1Rlc3RpbmcgVVVJRCBnZW5lcmF0aW9uLi4uJyk7XHJcblxyXG4gICAgICAgIGNvbnN0IHV1aWRzID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcclxuICAgICAgICAgICAgY29uc3QgdXVpZCA9IHRoaXMucHJlZmFiVG9vbHNbJ2dlbmVyYXRlVVVJRCddKCk7XHJcbiAgICAgICAgICAgIHV1aWRzLnB1c2godXVpZCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGBVVUlEICR7aSArIDF9OiAke3V1aWR9YCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBDaGVjayBVVUlEIGZvcm1hdFxyXG4gICAgICAgIGNvbnN0IHV1aWRQYXR0ZXJuID0gL15bMC05YS1mXXs4fS1bMC05YS1mXXs0fS1bMC05YS1mXXs0fS1bMC05YS1mXXs0fS1bMC05YS1mXXsxMn0kL2k7XHJcbiAgICAgICAgY29uc3QgdmFsaWRVdWlkcyA9IHV1aWRzLmZpbHRlcih1dWlkID0+IHV1aWRQYXR0ZXJuLnRlc3QodXVpZCkpO1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhgVVVJRCBmb3JtYXQgdmFsaWRhdGlvbjogJHt2YWxpZFV1aWRzLmxlbmd0aH0vJHt1dWlkcy5sZW5ndGh9IHZhbGlkYCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ1VVSUQgZ2VuZXJhdGlvbiB0ZXN0IGNvbXBsZXRlZFxcbicpO1xyXG4gICAgfVxyXG59XHJcblxyXG4vLyBJZiBydW5uaW5nIHRoaXMgZmlsZSBkaXJlY3RseVxyXG5pZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcclxuICAgIGNvbnN0IHRlc3QgPSBuZXcgUHJlZmFiVG9vbHNUZXN0KCk7XHJcbiAgICB0ZXN0LnJ1bkFsbFRlc3RzKCk7XHJcbiAgICB0ZXN0LnRlc3RQcmVmYWJEYXRhR2VuZXJhdGlvbigpO1xyXG4gICAgdGVzdC50ZXN0VVVJREdlbmVyYXRpb24oKTtcclxufSAiXX0=